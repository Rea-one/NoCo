# 语言设计思考档案

## 1. 核心目标
- **高性能**：通过AOT编译和RAII资源管理实现。
- **高灵活与DSL友好**：支持嵌套结构和领域特定语法，使用AST强绑定和图流结构。
- **高可读性**：通过清晰语法和模式匹配实现。
- **AST与代码高度映射**：构造时记录token位置信息。
- **图流结构**：支持流程图、状态机等DSL，使用`graph { ... }`结构。
- **无损数据原型**：记录运算过程，支持代数化简。

## 2. AST 构建与可视化
- AST 与代码高度映射，支持序列化/反序列化（JSON/YAML）。
- AST 节点应记录 token 位置信息（行号、列号），便于调试和报错。
- 支持访问者模式，用于解释、编译、打印等操作。

## 3. 图流结构（Graph Flow）
- 每个 `node` 是一个作用域。
- 用node代替其他编程语言的function，作用是相同的，但是这里更符合图流这个设计概念。
- `next` 和 `parallel` 定义节点之间的连接。
- 整个 `graph` 是一个顶层作用域容器。

## 4. 数值表达式树（无损计算原型）
- 不直接计算浮点数，而是构建表达式树。
- 支持代数化简、延迟求值、任意精度计算。
- 使用 `BigDecimal` 替代 `double` 提升精度。
- 可视化表达式树便于调试和优化。

## 5. Tokenizer 设计改进
- 明确 Token 类型（Identifier, NumberLiteral, BooleanLiteral 等）。
- 记录 token 的行号、列号、偏移量，便于调试。
- 支持多字符操作符（如 `->`, `+>`）和复合关键字（如 `match-case-default`）。

## 6. 解析器实现策略
- 使用递归下降解析器，每个函数返回 AST 节点。
- 分阶段处理：预处理、基础语法单元识别、高级结构构建。
- 示例：`parseGraphDeclaration()` → `GraphDeclaration` 节点。

## 7. 内存安全与生命周期控制
- 使用 RAII 模式确保资源自动释放。
- 建议引入借用检查器或轻量级生命周期分析。
- 类型系统中区分可空与非可空类型。

## 8. 工具链建设
- 构建 REPL 环境。
- 实现 LSP 服务（语法高亮、自动补全、跳转定义）。
- AST 可视化工具。
- 代码格式化器。

## 9. 后续增强方向
- **第一阶段**：基础安全保障（RAII、边界检查）。
- **第二阶段**：编译期检查增强（生命周期注解、借用检查）。
- **第三阶段**：完整内存安全模型（Send/Sync 标记）。

## 10. 开发优先级建议
1. ✅ 完善 Tokenizer
2. ✅ 定义 AST 基类与具体节点
3. ✅ 实现递归下降解析器
4. ✅ 添加图流结构支持
5. ✅ 实现数值表达式树
6. ✅ AST 可视化输出

## 25.6.4  更新：

1. 完善了token功能
2. 修改了代码对象的抽象
    对token采用两层分类，
后面想不清楚了，以后再想。
